# AI文字游戏渲染器 - 开发顺序指导文档

## 📋 文档说明

本文档详细说明了基于**UI先行策略**的开发顺序，每个任务完成后在界面上可以看到的变化，以及该功能模块在项目中的使用场景。

## 🎯 开发策略概述

```
开发流程：UI界面集成 → 基础架构+UI组件 → 核心功能 → 配置系统 → 扩展功能
           ↓              ↓              ↓         ↓         ↓
         视觉界面      模块框架+交互     业务逻辑   系统配置   高级特性
                       (Task16+17)
```

**核心理念**：每完成一个模块，立即在UI界面验证效果，确保开发进度可视化。

---

## 🚀 Phase 1: UI界面 + 基础架构 (Week 1-2)

### Task 1: 项目脚手架搭建

**开发内容**：
- 初始化Vite + React + TypeScript项目
- 配置Tailwind CSS、ESLint、Prettier
- 设置项目目录结构
- 配置开发环境和构建脚本

**完成后界面变化**：
- ✅ 浏览器能访问 `http://localhost:5173`
- ✅ 显示React默认欢迎页面
- ✅ 热更新功能正常工作
- ✅ TypeScript编译无错误

**项目使用场景**：
- 作为整个项目的基础框架
- 提供开发环境和构建流程
- 确保代码质量和开发效率

---

### UI集成: 现有界面集成 (与Task 2-3并行)

#### UI.1 现有界面评估 (0.5天)

**开发内容**：
- 分析现有UI的技术栈兼容性
- 评估组件结构和样式方案
- 识别四个固定区域布局
- 检查移动端适配完整性

**完成后界面变化**：
- ✅ 生成技术栈兼容性报告
- ✅ 创建UI组件结构清单
- ✅ 完成区域功能映射表

**项目使用场景**：
- 为UI迁移提供技术基础
- 确定最佳集成策略
- 避免重复开发工作

#### UI.2 界面迁移集成 (1.5天)

**开发内容**：
- 现有UI组件迁移到项目中
- 适配TypeScript类型定义
- 确保Tailwind CSS兼容
- 设置基础Mock数据展示

**完成后界面变化**：
- ✅ 四个游戏区域正常显示：
  ```
  ┌─────────────────────────────────┐
  │          场景描述区              │  [状态📊]
  │  "欢迎来到AI文字游戏世界..."     │  (收起状态)
  ├─────────────────────────────────┤
  │          旁白区                 │
  │  "游戏即将开始..."              │
  ├─────────────────────────────────┤
  │          行动选择区              │
  │  [选项A] [选项B] [选项C]         │
  └─────────────────────────────────┘
  ```
- ✅ 基础交互功能可用(按钮点击、输入框)
- ✅ 移动端和桌面端布局正常

**项目使用场景**：
- 提供完整的游戏界面框架
- 作为后续功能开发的视觉载体
- 用户交互的主要界面

#### UI.3 基础交互框架 (1天)

**开发内容**：
- 添加简单的状态管理Hook
- 实现基础事件处理机制
- 创建Mock数据更新接口
- 设置界面更新验证机制

**完成后界面变化**：
- ✅ 点击选项按钮能看到选中效果
- ✅ 在开发者控制台能通过代码更新界面：
  ```javascript
  // 在浏览器控制台测试
  window.updateScene("新的场景描述");
  window.updateOptions(["新选项A", "新选项B", "新选项C"]);
  window.updateStatus({health: 80, level: 2});
  ```
- ✅ Mock数据变化实时反映到界面

**项目使用场景**：
- 为后续模块提供界面更新接口
- 验证UI组件的数据绑定能力
- 支持模块开发时的实时测试

---

### Task 2: 类型系统建设 (与UI集成并行)

**开发内容**：
- 创建核心数据类型定义
- 游戏相关类型(UserInput、GameState等)
- 配置相关类型(WorldConfig、StatusConfig等)
- 错误处理类型和接口枚举

**完成后界面变化**：
- ✅ TypeScript编译器提供完整的类型提示
- ✅ 在VS Code中有智能代码补全
- ✅ 界面组件props有完整类型检查

**项目使用场景**：
- 为整个项目提供类型安全保障
- 提升开发效率和代码质量
- 减少运行时错误

---

### Task 3: 常量和工具函数 (与UI集成并行)

**开发内容**：
- 创建常量定义
- 错误码定义
- 默认配置常量
- 基础工具函数库

**完成后界面变化**：
- ✅ 界面显示规范化的常量值
- ✅ 错误提示使用统一的错误码
- ✅ 开发者工具显示工具函数可用

**项目使用场景**：
- 提供项目统一的常量和工具
- 支持错误处理和数据验证
- 简化重复代码编写

---

### Task 16: 基础UI组件 (并行于Phase 2)

**开发内容**：
- 按钮、输入框、选择器等基础组件
- 模态框、通知、加载状态组件
- 表单组件和验证
- 图标系统

**完成后界面变化**：
- ✅ 界面组件风格统一，交互体验提升
- ✅ 统一的加载状态和错误提示
- ✅ 表单验证实时反馈
- ✅ 状态栏展开功能：
  ```
  点击右侧[状态📊]按钮后：
  ┌─────────────────────────────────┐ ┌─────────────┐
  │          场景描述区              │ │   状态面板   │
  │  "欢迎来到AI文字游戏世界..."     │ │ ❤️ 100/100 │
  │                                │ │ 🎯 Lv.1    │
  ├─────────────────────────────────┤ │ 💰 50      │
  │          旁白区                 │ │ [×]       │
  │  "游戏即将开始..."              │ └─────────────┘
  ├─────────────────────────────────┤
  │          行动选择区              │
  │  [选项A] [选项B] [选项C]         │
  └─────────────────────────────────┘
  ```

**项目使用场景**：
- 提供统一的UI组件库
- 确保界面风格一致性
- 实现状态栏的展开/收起交互

---

### Task 17: 游戏界面组件

**开发内容**：
- 场景描述区组件
- 旁白区组件  
- 行动选择区组件
- 角色状态栏组件(收起/展开功能)

**完成后界面变化**：
- ✅ 游戏界面各区域功能完整：
  ```
  ┌─────────────────────────────────┐
  │ 🌲 森林深处                     │  [📊]
  │ 阳光透过树叶洒在小径上，远处传来│
  │ 鸟儿的啁啾声。一个神秘的洞穴出现│
  │ 在你的视野中...                 │
  ├─────────────────────────────────┤
  │ 💭 你感到好奇心驱使着你向前探索   │
  ├─────────────────────────────────┤
  │ A.🚶进入洞穴  B.🔍仔细观察  C.🔄返回│
  └─────────────────────────────────┘
  
  点击[📊]展开状态栏：
                                     ┌─────────────┐
                                     │ ❤️ 85/100   │
                                     │ 🎯 Lv.3     │  
                                     │ 💰 150      │
                                     │ 🏃 疲劳:轻微  │
                                     │ [收起×]     │
                                     └─────────────┘
  ```
- ✅ 支持文字动画效果
- ✅ 选项按钮有悬停和点击效果
- ✅ 状态栏支持展开/收起和进度条动画

**项目使用场景**：
- 提供核心游戏界面
- 展示AI生成的游戏内容
- 支持用户游戏交互
- 实现状态信息的按需显示

---

## 🔧 Phase 2: 核心功能模块 (Week 3-4)

### Task 4: 事件总线系统

**开发内容**：
- 实现事件总线核心类
- 事件订阅/发布机制
- 事件类型定义
- 模块间通信接口

**完成后界面变化**：
- ✅ 在浏览器控制台能测试事件系统：
  ```javascript
  // 发布事件测试
  EventBus.emit('game:scene-updated', newSceneData);
  EventBus.on('game:option-clicked', handleOptionClick);
  ```
- ✅ 界面交互触发相应事件，控制台显示事件日志

**项目使用场景**：
- 实现模块间的松耦合通信
- 支持游戏事件的发布和订阅
- 为状态管理提供事件基础

---

### Task 5: 游戏状态管理

**开发内容**：
- 使用Zustand创建游戏状态store
- 实现状态更新逻辑
- 历史记录管理
- 状态快照和回滚功能

**完成后界面变化**：
- ✅ 界面状态能持久保持，刷新页面后状态不丢失
- ✅ 在React DevTools中能查看状态变化：
  ```
  GameStore: {
    currentScene: "你站在一个十字路口...",
    gameOptions: [{id: "A", text: "向左走"}, ...],
    playerStatus: {health: 100, level: 1},
    gameHistory: [...]
  }
  ```
- ✅ 状态更新能自动触发界面重新渲染
- ✅ 支持撤销操作，界面能回滚到上一状态

**项目使用场景**：
- 管理整个游戏的状态数据
- 支持游戏进度的保存和恢复
- 为AI响应提供状态更新接口

---

### Task 7: AI服务适配器基础架构

**开发内容**：
- 定义统一的AIServiceAdapter接口
- 实现连接管理基类
- 请求/响应处理基类
- 错误处理基类

**完成后界面变化**：
- ✅ 在设置页面显示AI服务配置选项：
  ```
  ┌──────────────────────────────┐
  │      AI服务配置               │
  ├──────────────────────────────┤
  │ 服务商: [DeepSeek ▼]          │
  │ API密钥: [****************]   │
  │ 模型: [deepseek-chat ▼]       │
  │ [测试连接]    [保存配置]      │
  └──────────────────────────────┘
  ```
- ✅ 点击"测试连接"显示连接状态

**项目使用场景**：
- 为不同AI服务提供统一接口
- 管理AI服务的连接和配置
- 支持多AI服务的无缝切换

---

### Task 8: DeepSeek适配器开发

**开发内容**：
- 实现DeepSeek API连接
- 支持推理模式和KV缓存
- 请求构建和响应解析
- DeepSeek特定错误处理

**完成后界面变化**：
- ✅ AI服务状态显示"DeepSeek已连接"
- ✅ 在游戏界面能发送消息并收到AI回复：
  ```
  用户输入: "我想探索森林"
  AI回复显示在界面:
  ┌─────────────────────────────────┐
  │ 场景: 你走进了茂密的森林...      │
  │ 旁白: 树叶沙沙作响...           │
  │ 选项: A.继续前进 B.停下观察...   │
  │ 状态: 生命值-5 (森林探索)       │
  └─────────────────────────────────┘
  ```
- ✅ 推理模式开启时，显示AI思考过程
- ✅ Token使用量统计在界面显示

**项目使用场景**：
- 提供核心的AI对话功能
- 支持推理模式的高质量回复
- 优化成本控制(KV缓存)

---

### Task 11: AI响应解析引擎

**开发内容**：
- JSON提取和解析
- 四步错误处理(约束→校验→兜底→重试)
- 字段映射和修复
- 默认值填充

**完成后界面变化**：
- ✅ AI返回不完整JSON时，界面仍能正常显示：
  ```javascript
  // AI返回: {"scene": "森林深处", "narr
  // 解析引擎自动修复后界面显示:
  场景: "森林深处"
  旁白: "继续你的冒险..." (默认值)
  选项: ["继续", "等待", "返回"] (默认选项)
  ```
- ✅ 解析错误在开发者工具显示详细日志
- ✅ 解析成功率统计在界面显示

**项目使用场景**：
- 确保AI响应的稳定解析
- 提供强大的容错机制
- 减少因AI输出格式问题导致的游戏中断

---

## 🎛 Phase 3: 配置系统 (Week 5-6)

### Task 12: 世界观配置系统

**开发内容**：
- 世界观编辑器组件
- 配置验证规则
- 配置保存/加载
- 预设模板系统

**完成后界面变化**：
- ✅ 配置页面显示世界观编辑器：
  ```
  ┌─────────────────────────────────┐
  │        世界观配置               │
  ├─────────────────────────────────┤
  │ [中世纪奇幻 ▼] [现代都市 ▼]      │
  │                                │
  │ 世界观描述:                     │
  │ ┌─────────────────────────────┐ │
  │ │这是一个充满魔法的中世纪世界... │ │
  │ │                           │ │
  │ │                           │ │
  │ └─────────────────────────────┘ │
  │ [保存] [预览] [重置]            │
  └─────────────────────────────────┘
  ```
- ✅ 世界观配置能实时预览，影响AI回复风格

**项目使用场景**：
- 定义游戏的世界观和背景设定
- 影响AI生成内容的风格和逻辑
- 支持多种预设模板快速开始

---

### Task 13: 状态栏配置系统

**开发内容**：
- 状态字段定义编辑器
- 字段类型支持(进度条、数值等)
- 初始值设置
- 配置预览功能

**完成后界面变化**：
- ✅ 状态栏配置界面：
  ```
  ┌─────────────────────────────────┐
  │        状态栏配置               │
  ├─────────────────────────────────┤
  │ 字段名称: [生命值    ]           │
  │ 字段类型: [进度条 ▼]             │
  │ 初始值: [100] 最大值: [100]      │
  │ [添加字段] [删除]               │
  │                                │
  │ 预览:                          │
  │ 生命值: ████████████ 100/100   │
  │ 等级: 1                        │
  │ 金币: 50                       │
  └─────────────────────────────────┘
  ```
- ✅ 配置的状态字段实时显示在游戏界面
- ✅ AI回复能正确更新配置的状态字段

**项目使用场景**：
- 自定义角色属性和游戏状态
- 支持不同世界观的状态系统
- 为AI提供状态更新的参考字段

---

### Task 14: AI配置管理

**开发内容**：
- AI服务配置界面
- 连接测试功能
- 密钥安全存储
- 配置验证和提示

**完成后界面变化**：
- ✅ 完整的AI配置管理界面：
  ```
  ┌─────────────────────────────────┐
  │        AI服务配置               │
  ├─────────────────────────────────┤
  │ 主要服务: [DeepSeek ▼]          │
  │ ├─API密钥: [••••••••••••••••]   │
  │ ├─模型: [deepseek-reasoner ▼]   │
  │ └─推理模式: [✓] KV缓存: [✓]     │
  │                                │
  │ 备用服务: [Gemini ▼]            │
  │ ├─API密钥: [••••••••••••••••]   │
  │ └─模型: [gemini-2.5-flash ▼]    │
  │                                │
  │ [测试所有连接] [保存配置]        │
  │ 状态: ✅DeepSeek ✅Gemini       │
  └─────────────────────────────────┘
  ```
- ✅ 连接测试显示详细状态和延迟
- ✅ 支持多服务配置和自动切换

**项目使用场景**：
- 管理多个AI服务的配置
- 提供服务状态监控
- 支持AI服务的故障切换

---

## 🎨 Phase 4: 扩展功能 (Week 7-8)

### Task 20-23: 扩展卡片系统

**开发内容**：
- 卡片架构设计和工厂模式
- 卡片类型实现(列表、键值对、进度等)
- 卡片配置系统
- 卡片布局管理

**完成后界面变化**：
- ✅ 左右侧栏显示配置的扩展卡片：
  ```
  ┌────────┐  ┌─────游戏主界面─────┐  ┌────────┐
  │ 背包   │  │                   │  │ 任务   │
  │ ├─面包x2│  │    场景描述...     │  │ ✓探索森林│
  │ ├─药水x1│  │                   │  │ ◯找到宝藏│
  │ └─钥匙x1│  │    选项按钮...     │  │ ◯回到城镇│
  │────────│  │                   │  │────────│
  │ 好感度  │  └───────────────────┘  │ 技能   │
  │ ├─艾莉娅│  │                   │  │ 剑术:Lv2│
  │ │ ❤❤❤◯◯ │  │    状态栏...      │  │ 魔法:Lv1│
  │ └─商人  │  │                   │  │ 潜行:Lv3│
  │   ❤❤◯◯◯ │  └───────────────────┘  └────────┘
  └────────┘
  ```
- ✅ 卡片内容根据AI回复动态更新
- ✅ 支持拖拽调整卡片位置
- ✅ 移动端卡片收纳为抽屉式

**项目使用场景**：
- 显示游戏中的详细信息
- 增强游戏的沉浸感
- 支持复杂游戏机制的展示

---

### Task 24-27: 数据存储模块

**开发内容**：
- localStorage/IndexedDB封装
- 游戏历史管理
- 导入导出系统
- 缓存管理

**完成后界面变化**：
- ✅ 设置页面新增数据管理选项：
  ```
  ┌─────────────────────────────────┐
  │        数据管理                 │
  ├─────────────────────────────────┤
  │ 存储使用: ████████░░ 8.5/10MB   │
  │ 游戏回合: 127 (最近100已压缩)    │
  │                                │
  │ [导出存档] [导入存档]            │
  │ [清理缓存] [重置所有数据]        │
  │                                │
  │ 历史记录:                       │
  │ ├─ 2025-01-15 森林探险 (45回合)  │
  │ ├─ 2025-01-14 城镇任务 (23回合)  │
  │ └─ 2025-01-13 初始冒险 (12回合)  │
  └─────────────────────────────────┘
  ```
- ✅ 游戏进度自动保存，重启后继续
- ✅ 支持导出游戏数据为JSON文件

**项目使用场景**：
- 保存游戏进度和配置
- 支持数据备份和迁移
- 管理存储空间和性能

---

## 🧪 Phase 5: 测试和优化 (Week 9-10)

### Task 28-32: 错误处理和性能优化

**完成后界面变化**：
- ✅ 错误提示更友好，有具体的解决建议
- ✅ 界面响应速度提升，动画更流畅
- ✅ 支持暗黑模式和多主题切换
- ✅ 多语言界面支持

**项目使用场景**：
- 提升用户体验
- 增强系统稳定性
- 支持国际化需求

---

### Task 33-36: 测试和部署

**完成后界面变化**：
- ✅ 添加"关于"页面，显示版本信息和更新日志
- ✅ 生产版本优化，加载速度提升
- ✅ 支持PWA安装到桌面

**项目使用场景**：
- 确保产品质量
- 提供生产部署版本
- 支持多平台访问

---

## 📊 开发进度检查清单

### Phase 1 完成标志
- [ ] 浏览器能正常访问游戏界面
- [ ] 现有UI界面成功集成到项目中
- [ ] 四个游戏区域布局正确(状态栏默认收起)
- [ ] Mock数据能正常显示
- [ ] 基础交互功能可用(包括状态栏展开/收起)
- [ ] Task 16和17完成：UI组件库和游戏界面组件就绪
- [ ] 开发者控制台能更新界面

### Phase 2 完成标志  
- [ ] AI服务能正常连接和对话
- [ ] 游戏状态能正确管理和持久化
- [ ] AI回复能正确解析和显示
- [ ] 错误处理机制正常工作

### Phase 3 完成标志
- [ ] 配置系统完整可用
- [ ] 自定义世界观和状态栏生效
- [ ] 多AI服务配置和切换正常

### Phase 4-5 完成标志
- [ ] 扩展卡片系统正常工作
- [ ] 数据存储和导入导出功能完整
- [ ] 性能优化和错误处理完善
- [ ] 生产部署版本可用

---

**总结**：按照此开发顺序，每个阶段都有明确的界面验证标准，确保开发进度可视化，问题能及时发现和解决。最终交付一个功能完整、体验优良的AI文字游戏渲染器。